<!DOCTYPE html>
<html>
<head>
    <title>Panel Técnico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/global.css">
</head>
<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0">Panel Técnico</h1>
            <a href="{{ url_for('index') }}" class="btn-regresar inicio-top-right ms-3" title="Regresar">Inicio</a>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    <form method="GET" class="d-flex align-items-center panel-filtros-form panel-filtros-grid">
            <div class="panel-filtros-col">
                <label for="fecha_registro" class="panel-filtros-label">Fecha</label>
                <input type="date" name="fecha_registro" id="fecha_registro" class="form-control form-control-sm panel-filtros-input-sm" value="{{ request.args.get('fecha_registro', '') }}">
            </div>
            <div class="panel-filtros-col">
                <label for="id_servicio" class="panel-filtros-label">ID</label>
                <input type="number" name="id_servicio" id="id_servicio" class="form-control form-control-sm panel-filtros-input-id" placeholder="123" value="{{ request.args.get('id_servicio', '') }}">
            </div>
            <div class="panel-filtros-col">
                <label for="cliente" class="panel-filtros-label">Cliente</label>
                <input type="text" name="cliente" id="cliente" class="form-control form-control-sm panel-filtros-input-wide" placeholder="Ej: Juan Pérez" value="{{ request.args.get('cliente', '') }}">
            </div>
            <div class="panel-filtros-col">
                <label for="buscar" class="panel-filtros-label">Buscar</label>
                <input type="text" name="buscar" id="buscar" class="form-control form-control-sm panel-filtros-input-wide" placeholder="Ej: Laptop, HP" value="{{ request.args.get('buscar', '') }}">
            </div>
            <div class="panel-filtros-col">
                <label for="estado" class="panel-filtros-label">Estado</label>
                <select name="estado" id="estado" class="form-control form-control-sm panel-filtros-input-sm">
                    <option value="">Todos</option>
                    <option value="En diagnóstico" {% if request.args.get('estado') == 'En diagnóstico' %}selected{% endif %}>En diagnóstico</option>
                    <option value="En reparación" {% if request.args.get('estado') == 'En reparación' %}selected{% endif %}>En reparación</option>
                    <option value="Listo para entrega" {% if request.args.get('estado') == 'Listo para entrega' %}selected{% endif %}>Listo para entrega</option>
                </select>
            </div>
            <div class="panel-filtros-col">
                <label for="tipo_equipo" class="panel-filtros-label">Equipo</label>
                <select name="tipo_equipo" id="tipo_equipo" class="form-control form-control-sm panel-filtros-input-sm">
                    <option value="">Todos</option>
                    <option value="Laptop" {% if request.args.get('tipo_equipo') == 'Laptop' %}selected{% endif %}>Laptop</option>
                    <option value="CPU" {% if request.args.get('tipo_equipo') == 'CPU' %}selected{% endif %}>CPU</option>
                    <option value="Impresora" {% if request.args.get('tipo_equipo') == 'Impresora' %}selected{% endif %}>Impresora</option>
                    <option value="Otros" {% if request.args.get('tipo_equipo') == 'Otros' %}selected{% endif %}>Otros</option>
                </select>
            </div>
            <div class="panel-filtros-col" style="justify-content:end; height:100%;">
                <label class="panel-filtros-label">&nbsp;</label>
                <div class="panel-filtros-btns">
                    <button type="submit" class="btn-aceptar btn-form-main panel-filtros-btn panel-filtros-btn-small">Filtrar</button>
                    <a href="{{ url_for('tecnico.panel') }}" class="btn-cancelar btn-form-main panel-filtros-btn panel-filtros-btn-small" title="Limpiar filtros">Limpiar</a>
                </div>
            </div>
        </form>
    <!-- Botón Inicio movido al header -->
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Cliente</th>
                    <th>Tipo Equipo</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for servicio in servicios %}
                <tr>
                    <td>{{ servicio['id'] }}</td>
                    <td>{{ servicio['nombre'] }} {{ servicio['primer_apellido'] }} {{ servicio['segundo_apellido'] }}</td>
                    <td>{{ servicio['tipo_equipo'] }}</td>
                    <td>{{ servicio['estado'] }}</td>
                    <td>
                        <a href="{{ url_for('tecnico.editar', id=servicio['id']) }}" class="btn-panel-alt btn-sm" title="Editar">Retomar</a>
                        {% if servicio['estado'] == 'Listo para entrega' %}
                        <a href="{{ url_for('impresion.reporte', id=servicio['id']) }}" class="btn-reporte-final btn-sm" title="Reporte">Reporte</a>
                        {% endif %}
                        <!-- Formulario para el botón de eliminar -->
                        <form action="{{ url_for('tecnico.eliminar_servicio', id=servicio['id']) }}" method="POST" style="display: inline;" onsubmit="return confirm('¿Estás seguro de que deseas eliminar este servicio? Esta acción no se puede deshacer.');">
                            <button type="submit" class="btn-cancelar btn-sm" title="Eliminar Servicio">Eliminar</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>