<!DOCTYPE html>
<html>
<head>
    <title>Registrar Equipo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/global.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <link rel="stylesheet" href="/static/css/estilos.css">
</head>

<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="mb-0">Registrar Equipo</h1>
            <a href="{{ url_for('index') }}" class="btn-regresar btn-form-main inicio-top-right ms-3" title="Inicio">Inicio</a>
        </div>
                <!-- este nos muestra elmensaje al agregar el equipo nuevo -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            {% if category != 'success' %} <!-- Filtrar mensajes de éxito para que el backend mueste solo mensajes 
                                    de error y los de exito se validen con la notificación emergente -->
                                <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endif %}    
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
        <form method="POST" enctype="multipart/form-data" id="registroForm">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="fecha_registro">Fecha de Registro</label>
                        <input type="text" id="fecha_registro" class="form-control" value="{{ datetime.now().strftime('%Y-%m-%d %H:%M:%S') }}" readonly disabled>
                    </div>
                </div>
            </div>
            <div class="row"> <!-- dividimos en 3 columnas para aprovechar el ancho de la pantalla -->
               
                <!-- Datos del usuario -->
                <div class="col-md-4">
                    <div class="mb-3">
                        <label>Nombre</label>
                        <input type="text" name="nombre" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Primer Apellido</label>
                        <input type="text" name="primer_apellido" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Segundo Apellido</label>
                        <input type="text" name="segundo_apellido" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Teléfono</label>
                        <input type="text" name="telefono" id="telefono" class="form-control" pattern="[0-9]{10}" maxlength="10" title="10 dígitos" required>
                    </div>
                </div>

                <!-- Datos de equipo -->
                <div class="col-md-4">
                    <div class="mb-3">
                        <label>Tipo de Equipo</label>
                        <select name="tipo_equipo" id="tipo_equipo" class="form-control" required>
                            <option value="Laptop">Laptop</option>
                            <option value="CPU">CPU</option>
                            <option value="Impresora">Impresora</option>
                            <option value="Otros">Otros</option>
                        </select>
                        <input type="text" name="otros_equipo" id="otros_equipo" class="form-control mt-2" placeholder="Especifique el equipo" disabled>
                    </div>
                    <div class="mb-3">
                        <label>Marca</label>
                        <input type="text" name="marca" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Modelo</label>
                        <input type="text" name="modelo" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label>Serie (opcional)</label>
                        <input type="text" name="serie" class="form-control">
                    </div>
                </div>

                <!-- Servicios y accesorios -->
                <div class="col-md-4">
                    <div class="mb-3">
                        <label>Servicio Solicitado</label>
                        <div class="form-check">
                            <input type="checkbox" name="servicio" value="Mantenimiento Preventivo" class="form-check-input">
                            <label class="form-check-label">Mantenimiento Preventivo</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="servicio" value="Mantenimiento Correctivo" class="form-check-input">
                            <label class="form-check-label">Mantenimiento Correctivo</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="servicio" value="Diagnóstico" class="form-check-input">
                            <label class="form-check-label">Diagnóstico</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="servicio" value="Otros" class="form-check-input" id="otros_servicio_check">
                            <label class="form-check-label">Otros</label>
                            <input type="text" name="otros_servicio" class="form-control mt-2" placeholder="Especifique el servicio" disabled>
                        </div>
                    </div>
                
                    <!-- Accesorios -->
                    <div class="mb-3">
                        <label>Accesorios Recibidos</label>
                        <div class="form-check">
                            <input type="checkbox" name="accesorios" value="Cargador" class="form-check-input">
                            <label class="form-check-label">Cargador</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="accesorios" value="Cable de Energía" class="form-check-input">
                            <label class="form-check-label">Cable de Energía</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="accesorios" value="Cable USB" class="form-check-input">
                            <label class="form-check-label">Cable USB</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="accesorios" value="Tóner" class="form-check-input">
                            <label class="form-check-label">Tóner</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="accesorios" value="Otros" class="form-check-input" id="otros_accesorios_check">
                            <label class="form-check-label">Otros</label>
                            <input type="text" name="otros_accesorios" class="form-control mt-2" placeholder="Especifique el accesorio" disabled>
                        </div>
                        <div class="mb-3">
                            <label>Foto Inicial</label>
                            <input type="file" name="foto_inicial" class="form-control" accept="image/jpeg,image/png">
                        </div>
                    </div>     
                </div>    
            </div>       

            <div class="row">
                <div class="col-12 d-flex justify-content-center gap-btns">
                    <button type="submit" class="btn-aceptar btn-form-main" title="Registrar">Registrar</button>
                    <a href="{{ url_for('index') }}" class="btn-cancelar btn-form-main" title="Cancelar">Cancelar</a>
                </div>
            </div>
        </form>
    </div>
    <script>
        document.getElementById('otros_servicio_check').addEventListener('change', function() {
            const otrosInput = document.querySelector('input[name="otros_servicio"]');
            otrosInput.disabled = !this.checked;
            if (!this.checked) otrosInput.value = '';
        });
        document.getElementById('otros_accesorios_check').addEventListener('change', function() {
            const otrosInput = document.querySelector('input[name="otros_accesorios"]');
            otrosInput.disabled = !this.checked;
            if (!this.checked) otrosInput.value = '';
        });
        document.getElementById('tipo_equipo').addEventListener('change', function() {
            const otrosInput = document.getElementById('otros_equipo');
            otrosInput.disabled = this.value !== 'Otros';
            if (this.value !== 'Otros') otrosInput.value = '';
        });
            
        const telefonoInput = document.getElementById('telefono');
        const telefonoError = document.getElementById('telefonoError');
        const form = document.getElementById('registroForm');

        function validateTelefono() {
            telefonoInput.value = telefonoInput.value.replace(/[^0-9]/g, '');
            if (telefonoInput.value.length === 10 && /^[0-9]{10}$/.test(telefonoInput.value)) {
                telefonoInput.classList.remove('is-invalid');
                telefonoInput.classList.add('is-valid');
                telefonoError.style.display = 'none';
            } else {
                telefonoInput.classList.remove('is-valid');
                telefonoInput.classList.add('is-invalid');
                telefonoError.style.display = 'block';
            }
        }

        form.addEventListener('submit', (event) => {
            if (telefonoInput.value.length !== 10 || !/^[0-9]{10}$/.test(telefonoInput.value)) {
                event.preventDefault();
                telefonoInput.classList.add('is-invalid');
                telefonoError.style.display = 'block';
                telefonoInput.focus();
            }
        });

        // Mostrar notificación de éxito si existe un mensaje flash
        document.addEventListener('DOMContentLoaded', function() {
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% for category, message in messages %}
                    {% if category == 'success' %}
                        Swal.fire({
                            title: '¡Éxito!',
                            text: '{{ message }}',
                            icon: 'success',
                            confirmButtonColor: '#1da6b3'
                        });
                    {% endif %}
                {% endfor %}
            {% endwith %}
        });

    </script>
        
    </body>
    </html>